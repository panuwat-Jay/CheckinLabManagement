{% extends 'cklab/base.html' %}
{% load static %}

{% block title %}กำลังใช้งาน - {{ user_name }}{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-center vh-100 px-3">

    <div class="text-center w-100 animate-fade" style="max-width: 600px;">
        <!-- Logo UBU -->
        <div class="mb-4">
            <img src="{% static 'cklab/img/ubulogo.png' %}" alt="Logo" style="height: 70px;">
        </div>

        <h5 class="text-muted mb-2 fw-normal">ผู้ใช้งานปัจจุบัน (Current User)</h5>
        <h2 id="userNameDisplay" class="text-accent mb-4 fw-bold">
            {{ user_name|default:"-" }}
        </h2>
        
        <div class="card timer-card p-5 mb-4 position-relative overflow-hidden">
            <!-- ตกแต่งขอบบนด้วยเส้นสีน้ำเงิน -->
            <div class="position-absolute top-0 start-0 w-100" style="height: 6px; background: linear-gradient(90deg, #003366, #0d6efd);"></div>
            
            <h1 class="display-1 fw-bold mb-0" id="timerDisplay">00:00:00</h1>
            <small class="text-muted mt-2 d-block fw-medium" id="timerLabel">ระยะเวลาที่ใช้งาน (Usage Time)</small>
            
            <!-- กล่องแจ้งเตือน -->
            <div id="alertBox" class="alert alert-warning mt-4 mb-0 d-none text-start animate-fade rounded-3 border-0 shadow-sm">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span id="alertMsg">แจ้งเตือน...</span>
            </div>
        </div>

        <h4 class="mb-5">
            <span class="badge bg-primary px-4 py-2 rounded-pill shadow-sm" id="pcNameDisplay" style="background-color: #003366 !important;">
                Station: PC-{{ computer.pc_id|stringformat:"02d" }}
            </span>
        </h4>

        <div class="d-grid gap-3 d-sm-flex justify-content-center">
            <!-- ปุ่ม Check-out (เรียกใช้ฟังก์ชัน doCheckout จาก timer.js) -->
            <button onclick="doCheckout()" class="btn btn-danger btn-lg px-5 rounded-pill fw-bold shadow-sm transition-btn py-3">
                <i class="bi bi-box-arrow-right me-2"></i>เลิกใช้งาน (Check-out)
            </button>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    /**
     * Data Bridge: ส่งข้อมูลจาก Django Context ไปยังไฟล์ External JS
     * เนื่องจากไฟล์ .js ไม่สามารถอ่าน Template Tags ของ Django ได้โดยตรง
     */
    window.djangoData = {
        pcId: "{{ computer.pc_id }}",
        userName: "{{ user_name }}",
        startTime: "{{ start_time }}",
        forceEndTime: "{{ force_end_time|default:'' }}",
        monitorUrl: "{% url 'api_monitor_data' %}",
        feedbackUrl: "{% url 'feedback' %}",
        indexUrl: "{% url 'index' %}"
    };
</script>
<!-- โหลดไฟล์ Logic หลักจาก Static Folder -->
<script src="{% static 'cklab/js/timer.js' %}"></script>
{% endblock %}